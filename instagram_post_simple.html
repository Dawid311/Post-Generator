<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Instagram Post - Animiertes GIF + Audio</title>
  <link href="https://fonts.googleapis.com/css2?family=Pirata+One&display=swap" rel="stylesheet">
  <style>
    :root { --gold:#ffd700; }
    body { margin:0; font-family:'Pirata One',cursive; background:linear-gradient(135deg,#232526 0%,#1e2a38 100%); color:#fff; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:24px; padding:36px 20px 48px; box-sizing:border-box; }
    h1 { font-size:1.4rem; letter-spacing:2px; color:var(--gold); margin:0; text-shadow:0 2px 12px #000; text-align:center; }
    .card { position:relative; width:440px; max-width:95vw; background:rgba(30,40,50,.97); border-radius:18px; overflow:hidden; box-shadow:0 8px 32px rgba(0,0,0,0.5), 0 0 0 2px rgba(255,215,0,0.1); }
    .hero-image { width:100%; height:260px; background-size:cover; background-position:center; background-repeat:no-repeat; position:relative; filter:brightness(.85) grayscale(.1); background-image: url('_ARC6946.jpg'); }
    .heute-badge { position:absolute; top:15px; right:15px; background:linear-gradient(45deg, #ff6b6b, #ffd93d); color:#000; font-size:0.9rem; font-weight:bold; padding:8px 16px; border-radius:20px; text-transform:uppercase; letter-spacing:1px; box-shadow:0 4px 12px rgba(255,107,107,0.4); z-index:10; }
    .card-content { padding:32px 24px 24px; text-align:center; position:relative; }
    .title { font-size:2.4rem; color:var(--gold); letter-spacing:2px; margin:0 0 12px; text-shadow:0 2px 16px #000a; display:flex; align-items:center; justify-content:center; gap:15px; }
    .title .music-note { font-size:1.8rem; }
    .subtitle { font-size:1.3rem; margin:0 0 18px; text-shadow:0 2px 8px #ffd70090; }
    .details { font-size:1.1rem; color:#b8c6db; letter-spacing:1px; margin:0 0 18px; position:relative; }
    .details::before { content:"‚è∞"; margin-right:8px; color:var(--gold); }
    .cta { display:inline-block; background:linear-gradient(90deg,var(--gold),#fff); color:#232526; font-size:1.25rem; padding:12px 34px; border-radius:32px; letter-spacing:2px; text-transform:uppercase; box-shadow:0 2px 16px #ffd700a0, 0 0 20px rgba(255,215,0,0.3); position:relative; }
    .cta::before { content:"üé∏"; margin-right:8px; }
    .live-indicator { position:absolute; top:-5px; right:-5px; width:12px; height:12px; background:#ff4757; border-radius:50%; }
    
    /* Animation Klassen f√ºr verschiedene Blink-States */
    .pulse-1 .heute-badge { transform: scale(1.05); }
    .pulse-1 .music-note { opacity: 1; }
    .pulse-1 .details::before { opacity: 1; }
    .pulse-1 .cta::before { opacity: 1; }
    .pulse-1 .live-indicator { opacity: 1; }
    
    .pulse-2 .heute-badge { transform: scale(1); }
    .pulse-2 .music-note { opacity: 0.3; }
    .pulse-2 .details::before { opacity: 1; }
    .pulse-2 .cta::before { opacity: 0.3; }
    .pulse-2 .live-indicator { opacity: 0.3; }
    
    .pulse-3 .heute-badge { transform: scale(1.05); }
    .pulse-3 .music-note { opacity: 1; }
    .pulse-3 .details::before { opacity: 0.3; }
    .pulse-3 .cta::before { opacity: 1; }
    .pulse-3 .live-indicator { opacity: 0.3; }
    
    .pulse-4 .heute-badge { transform: scale(1); }
    .pulse-4 .music-note { opacity: 0.3; }
    .pulse-4 .details::before { opacity: 1; }
    .pulse-4 .cta::before { opacity: 0.3; }
    .pulse-4 .live-indicator { opacity: 1; }
    
    .status { font-size:.8rem; letter-spacing:1px; min-height:1rem; }
    .hidden { display:none!important; }
    .result { display:flex; flex-direction:column; align-items:center; gap:8px; }
    a.dl { background:#4CAF50; border:2px solid #4CAF50; color:white; padding:12px 24px; border-radius:12px; text-decoration:none; letter-spacing:1px; font-size:1rem; transition:.25s; }
    a.dl:hover { background:#45a049; box-shadow:0 0 12px #4CAF50; }
    .previewWrap { display:flex; flex-direction:column; align-items:center; gap:6px; }
    .note { font-size:.6rem; opacity:.55; text-align:center; max-width:520px; line-height:1.3; }
    .spinner { width:52px; height:52px; border:5px solid #ffffff22; border-top-color:var(--gold); border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .progress-container { width:100%; max-width:400px; background:#16212b; border-radius:10px; padding:8px; margin:16px 0; }
    .progress-bar { height:12px; background:linear-gradient(90deg,var(--gold),#fff); border-radius:6px; transition:width 0.3s ease; width:0%; }
    .progress-text { color:var(--gold); font-size:0.9rem; text-align:center; margin-top:8px; }
  </style>
</head>
<body>
  <h1>Instagram Post - Animiertes GIF + Audio</h1>
  <div class="status" id="status">Lade...</div>
  <button onclick="location.reload()" style="background:#666; color:white; border:none; padding:8px 16px; border-radius:5px; margin:10px; cursor:pointer; font-size:12px;">üîÑ Neu starten</button>
  <div class="card pulse-1" id="captureTarget">
    <div class="hero-image">
      <div class="heute-badge">üî• HEUTE üî•</div>
    </div>
    <div class="card-content">
      <div class="title">
        <span class="music-note">üéµ</span>
        <span>KONZERT</span>
        <span class="music-note">üéµ</span>
      </div>
      <div class="subtitle">22.08 ‚Ä¢ 19:00 Uhr</div>
      <div class="details">Katys Garage, Dresden Neustadt<br>Live-Musik & Atmosph√§re</div>
      <div class="cta">
        Sei dabei!
        <div class="live-indicator"></div>
      </div>
    </div>
  </div>
  <div class="spinner" id="spinner"></div>
  <div class="progress-container hidden" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
    <div class="progress-text" id="progressText">0%</div>
  </div>
  <div class="result hidden" id="result">
    <div class="previewWrap">
      <img id="gifPreview" style="max-width:260px; border:2px solid var(--gold); border-radius:12px;" />
    </div>
    <a class="dl" id="dlGif" download="instagram_post_animated.gif">üéµ Download Animiertes GIF</a>
    <div style="margin-top:12px;">
      <audio id="syncAudio" controls style="width:100%; max-width:280px;">
        <source src="Katze_30sek.mp3" type="audio/mpeg">
        Audio-Track separat (30s)
      </audio>
    </div>
    <div class="note" style="margin-top:8px; opacity:0.8;">
      ‚ÜóÔ∏è GIF + Audio separat herunterladen und in Video-Editor kombinieren
    </div>
  </div>
  <p class="note">Export startet automatisch. Animiertes GIF wird erstellt, Audio separat verf√ºgbar. Beide Dateien k√∂nnen dann in einem Video-Editor zu MP4 kombiniert werden.</p>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
  <script>
    async function autoExport(){
      const statusEl=document.getElementById('status');
      const spinner=document.getElementById('spinner');
      const progressContainer=document.getElementById('progressContainer');
      const progressBar=document.getElementById('progressBar');
      const progressText=document.getElementById('progressText');
      const result=document.getElementById('result');
      const dlGif=document.getElementById('dlGif');
      const target=document.getElementById('captureTarget');
      const gifPreview=document.getElementById('gifPreview');
      
      try {
        statusEl.textContent='Vorbereitung...';
        await (document.fonts?.ready||Promise.resolve());
        await new Promise(r=>setTimeout(r,1000));
        
        // Progress Bar anzeigen
        spinner.classList.add('hidden');
        progressContainer.classList.remove('hidden');
        statusEl.textContent='Animiertes GIF wird erstellt...';
        
        // GIF erstellen
        const gif = new GIF({
          workers: 2,
          quality: 10,
          width: 1080,
          height: 1350,
          repeat: 0, // Endlos-Loop
          workerScript: 'https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.worker.js'
        });
        
        // 4 verschiedene Blink-States f√ºr Animation
        const blinkStates = ['pulse-1', 'pulse-2', 'pulse-3', 'pulse-4'];
        const frameDelay = 500; // 0.5 Sekunden pro Frame = 2 Sekunden total
        
        for(let i = 0; i < blinkStates.length; i++) {
          const progress = ((i + 1) / blinkStates.length) * 80; // 80% f√ºr Frame-Erstellung
          progressBar.style.width = progress + '%';
          progressText.textContent = `${Math.round(progress)}% - Frame ${i+1}/${blinkStates.length}`;
          statusEl.textContent = `Frame ${i+1}/${blinkStates.length} wird erfasst...`;
          
          // Blink-State anwenden
          target.className = `card ${blinkStates[i]}`;
          
          // Kurz warten f√ºr DOM-Update
          await new Promise(r=>setTimeout(r, 200));
          
          // Frame mit html2canvas erfassen
          const canvas = await html2canvas(target, {
            backgroundColor: null,
            scale: 3,
            useCORS: true,
            allowTaint: true,
            logging: false
          });
          
          // Gradient-Hintergrund hinzuf√ºgen
          const finalCanvas = document.createElement('canvas');
          finalCanvas.width = 1080;
          finalCanvas.height = 1350;
          const ctx = finalCanvas.getContext('2d');
          
          // Gradient-Hintergrund
          const grd = ctx.createLinearGradient(0,0,1080,1350);
          grd.addColorStop(0,'#232526');
          grd.addColorStop(1,'#1e2a38');
          ctx.fillStyle = grd;
          ctx.fillRect(0,0,1080,1350);
          
          // Content zentriert zeichnen
          const scale = Math.min(1080 * 0.9 / canvas.width, 1350 * 0.7 / canvas.height);
          const drawW = canvas.width * scale;
          const drawH = canvas.height * scale;
          const dx = (1080 - drawW) / 2;
          const dy = (1350 - drawH) / 2;
          
          ctx.drawImage(canvas, dx, dy, drawW, drawH);
          
          // Frame zum GIF hinzuf√ºgen
          gif.addFrame(finalCanvas, {delay: frameDelay});
        }
        
        statusEl.textContent = 'GIF wird gerendert...';
        progressBar.style.width = '90%';
        progressText.textContent = '90% - Rendering...';
        
        gif.on('finished', function(blob) {
          const url = URL.createObjectURL(blob);
          dlGif.href = url;
          gifPreview.src = url;
          
          progressBar.style.width = '100%';
          progressText.textContent = '100% - Fertig!';
          
          result.classList.remove('hidden');
          progressContainer.classList.add('hidden');
          statusEl.textContent = 'Animiertes GIF fertig!';
          
          setTimeout(() => { dlGif.click(); }, 400);
        });
        
        gif.on('progress', function(p) {
          const renderProgress = 90 + (p * 10);
          progressBar.style.width = renderProgress + '%';
          progressText.textContent = `${Math.round(renderProgress)}% - Rendering...`;
        });
        
        gif.render();
        
      } catch(e){ 
        console.error(e); 
        statusEl.textContent='Fehler: '+e.message; 
        spinner.classList.add('hidden'); 
        progressContainer.classList.add('hidden');
      }
    }
    
    window.addEventListener('load', ()=>{ setTimeout(autoExport,150); });
  </script>
</body>
</html>
